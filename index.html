<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <title>Multimodal LLM Chat</title>
  <!-- FontAwesome for icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
  <style>
    :root {
      --primary: #16b895;
      --accent: #6366f1;
      --bg: #f4f5f7;
      --bg-alt: #fff;
      --text: #21262c;
      --subtext: #757b90;
      --border: #d4d6dc;
      --radius: 18px;
      --shadow: 0 2px 16px rgba(16,184,149,0.07);
    }
    .profile-dropdown-wrap {
  position: relative;
  display: inline-block;
}
.profile-btn {
  background: none;
  border: none;
  cursor: pointer;
  padding: 0;
}
.profile-avatar {
  width: 38px;
  height: 38px;
  border-radius: 50%;
  border: 2px solid #ececf1;
  box-shadow: 0 1px 6px rgba(0,0,0,0.04);
  background: #fff;
  object-fit: cover;
}
.dropdown-menu {
  display: none;
  position: absolute;
  right: 0;
  top: 50px;
  background: #fff;
  min-width: 220px;
  border-radius: 12px;
  box-shadow: 0 3px 24px rgba(0,0,0,0.09);
  border: 1px solid #ececf1;
  z-index: 100;
  padding: 12px 0;
  font-size: 1rem;
  animation: fadeIn 0.18s;
}
@keyframes fadeIn {
  from {opacity:0; transform:translateY(-10px);}
  to {opacity:1; transform:translateY(0);}
}
.dropdown-menu.show {
  display: block;
}
.dropdown-email {
  color: #919395;
  padding: 8px 22px 4px 22px;
  font-size:0.97rem;
}
.dropdown-divider {
  border-top: 1px solid #ececf1;
  margin: 7px 0 5px 0;
}
.dropdown-item {
  padding: 8px 22px;
  color: #2c2d2e;
  text-decoration: none;
  display: flex;
  align-items: center;
  gap: 12px;
  transition: background 0.15s;
  font-weight: 500;
  cursor: pointer;
}
.dropdown-item i {
  min-width: 18px;
  text-align: center;
  color: #8e8fa0;
}
.dropdown-item:hover {
  background: #f7f7fa;
}

    html, body {
      height: 100%;
      margin: 0;
      font-family: 'Segoe UI', 'Montserrat', Arial, sans-serif;
      background: var(--bg);
      color: var(--text);
    }
    .app-main {
      display: flex;
      flex-direction: column;
      max-width: 480px;
      height: 100vh;
      margin: 0 auto;
      background: var(--bg-alt);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow: hidden;
      border: 1px solid var(--border);
    }
    header {
      flex-shrink: 0;
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: var(--bg-alt);
      padding: 20px;
      border-bottom: 1px solid var(--border);
    }
    header h1 {
      font-size: 1.5rem; font-weight: bold; color: var(--primary);
      letter-spacing: 0.03em;
    }
    .model-select {
      border: none; background: var(--bg);
      font-size: 1rem; padding: 5px 12px;
      border-radius: 12px;
      color: var(--text);
    }
    .chat-area {
      flex: 1;
      overflow-y: auto;
      padding: 24px 18px 12px 18px;
      background: var(--bg);
    }
    .message-row {
      display: flex; align-items: flex-end; margin-bottom: 18px;
    }
    .message-row.ai { flex-direction: row; }
    .message-row.user { flex-direction: row-reverse; }
    .message-avatar {
      width: 38px; height: 38px;
      border-radius: 50%; display: flex; align-items: center; justify-content: center;
      font-weight: bold; font-size: 1.1rem;
      background: var(--accent); color: #fff;
    }
    .message-row.user .message-avatar { background: var(--primary);}
    .message-content {
      max-width: 74%;
      padding: 16px 18px;
      border-radius: var(--radius);
      background: var(--bg-alt);
      margin: 0 10px;
      box-shadow: 0 2px 8px rgba(0,0,0,.03);
      font-size: 1rem;
      word-break: break-word;
    }
    .message-row.user .message-content { background: var(--primary); color:#fff;}
    .attachments {
      display: flex; gap: 10px;
      flex-wrap: wrap; margin: 10px 0 0 0;
    }
    .attachment-preview {
      display: flex; flex-direction: column;
      background: var(--bg-alt); border: 1px solid var(--border); padding: 10px 12px; border-radius: 10px;
      margin-bottom: 8px; box-shadow: var(--shadow);
    }
    .attachment-preview .att-head {
      display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;
      font-size: 0.97rem; color: var(--subtext);
    }
    .attachment-preview .att-clear {
      background: none; border: none; color: var(--accent); cursor: pointer; font-size: 1.1rem;
    }
    .attachment-list { display: flex; gap:8px; flex-wrap: wrap; }
    .preview-item {
      background: var(--bg); border: 1px solid var(--border);
      padding: 6px 10px; border-radius: 8px; min-width: 74px; display: flex; align-items: center; gap: 6px;
      font-size: 0.9rem;
    }
    .preview-item img { max-width:45px; max-height:45px; border-radius:8px; border:1px solid #eee; }
    .preview-item .remove { border:none; background:none; color:var(--primary); font-size:1.05rem; cursor:pointer;}
    .input-area {
      padding: 18px;
      background: var(--bg-alt);
      border-top: 1px solid var(--border);
      box-shadow: 0 -2px 12px rgba(16,184,149,.07);
      position: relative;
    }
    .input-bar {
      display: flex; align-items: flex-end; background: var(--bg);
      border-radius: var(--radius); border:1px solid var(--border); padding: 10px 14px;
      gap: 10px; box-shadow: var(--shadow);
    }
    .input-bar textarea {
      flex: 1; min-height: 32px; max-height: 75px; font-size: 1rem; border: none;
      background: transparent; resize: none; outline: none; color: var(--text);
    }
    .input-btns {
      display: flex; gap: 6px;
    }
    .input-btn {
      width: 38px; height: 38px; border-radius: 8px;
      background: var(--bg-alt); border: 1px solid var(--border);
      color: var(--subtext); display: flex; align-items: center; justify-content: center;
      font-size: 1.25rem; cursor: pointer; transition: 0.2s all;
    }
    .input-btn.active, .input-btn:hover { background: var(--primary); color: #fff; border-color: var(--primary);}
    .send-btn { background: var(--primary); color: #fff !important; border: none; font-weight: bold;}
    .char-count { font-size: 0.9rem; color: var(--subtext); margin-top:3px;}
    /* Modal Styles */
    .modal { display: none; position: fixed;
      z-index: 999; left:0; top:0; width:100%; height:100%;
      background: rgba(20,24,36,0.45); align-items: center; justify-content: center;
    }
    .modal.show { display: flex;}
    .modal-content { background: var(--bg-alt); border-radius: 15px; padding: 25px 18px 20px 18px; width:90%; max-width:350px; box-shadow: var(--shadow);}
    .modal-header { display:flex; align-items:center; justify-content:space-between; margin-bottom:10px; }
    .close-modal { background:none; border:none; cursor:pointer; color: var(--accent); font-size:1.3rem;}
    .drive-signin-btn { font-size:1rem; background: var(--accent); color: #fff; border-radius:8px; border:none; padding:10px 20px; display:flex; align-items:center; gap:8px; cursor:pointer;}
    .drive-files { margin-top:13px; max-height:180px; overflow-y:auto; }
    .drive-file { background:var(--bg); border:1px solid var(--border); border-radius:7px; padding:9px; margin-bottom:8px; display:flex; align-items:center; gap:10px; cursor:pointer;}
    .drive-file.selected { border-color:var(--primary); background:rgba(16,184,149,0.08);}
    @media (max-width:600px) {
      .app-main { width:100vw;border-radius:0;max-width:100vw;}
      header, .chat-area, .input-area {padding-left:8px;padding-right:8px;}
    }
  </style>
</head>
<body>
  <div class="app-main">
    <header>
      <h1><i class="fas fa-comments"></i> LLM Chat</h1>
      <div class="profile-dropdown-wrap">
  <button class="profile-btn" id="profileBtn">
    <img src="https://www.gravatar.com/avatar?d=mp" alt="User" class="profile-avatar">
  </button>
  <div class="dropdown-menu" id="profileDropdown">
    <div class="dropdown-email">makebussiness111@gmail.com</div>
    <div class="dropdown-divider"></div>
    <a href="#" class="dropdown-item"><i class="fas fa-rocket"></i> Upgrade plan</a>
    <a href="#" class="dropdown-item"><i class="fas fa-sliders-h"></i> Customize ChatGPT</a>
    <a href="#" class="dropdown-item"><i class="fas fa-cog"></i> Settings</a>
    <a href="#" class="dropdown-item"><i class="fas fa-question-circle"></i> Help</a>
    <a href="#" class="dropdown-item"><i class="fas fa-sign-out-alt"></i> Log out</a>
  </div>
</div>

    </header>
    <div class="chat-area" id="chatArea"></div>

    <div class="attachment-preview" id="attachmentPreview" style="display:none;">
      <div class="att-head">
        <span>Attachments</span>
        <button class="att-clear" id="clearAttachments"><i class="fas fa-times"></i></button>
      </div>
      <div class="attachment-list" id="previewList"></div>
    </div>
    
    <div class="input-area">
      <div class="input-bar">
        <div class="input-btns">
          <button class="input-btn" id="imageBtn" title="Add image">
            <i class="fas fa-image"></i>
          </button>
          <button class="input-btn" id="fileBtn" title="Add file">
            <i class="fas fa-paperclip"></i>
          </button>
          <button class="input-btn" id="driveBtn" title="From Drive">
            <i class="fab fa-google-drive"></i>
          </button>
          <button class="input-btn" id="micBtn" title="Voice input">
            <i class="fas fa-microphone"></i>
          </button>
        </div>
        <textarea id="messageInput" rows="1" maxlength="2000" placeholder="Type or attach something..."></textarea>
        <button class="input-btn send-btn" id="sendBtn" disabled><i class="fas fa-paper-plane"></i></button>
      </div>
      <div class="char-count"><span id="charCount">0</span>/2000</div>
      <input type="file" id="imageInput" accept="image/*" multiple style="display:none;">
      <input type="file" id="fileInput" accept=".pdf,.doc,.docx,.txt,.csv" multiple style="display:none;">
    </div>
  </div>
  <!-- Drive Modal -->
  <div class="modal" id="driveModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3><i class="fab fa-google-drive"></i> Google Drive</h3>
        <button class="close-modal" id="closeDrive"><i class="fas fa-times"></i></button>
      </div>
      <div id="driveAuth">
        <button class="drive-signin-btn" id="driveSignIn">
          <i class="fab fa-google"></i> Sign In
        </button>
      </div>
      <div id="driveContent" style="display:none;">
        <input type="text" id="driveSearch" placeholder="Search files..." style="width:100%; padding:8px;">
        <div class="drive-files" id="driveFiles"></div>
      </div>
    </div>
  </div>
  <!-- End Modal -->

<script>
const state = {
  messages: [],
  attachments: [],
  isTyping: false,
  isRecording: false,
  mediaRecorder: null,
  driveAuthenticated: false,
};

const $ = id => document.getElementById(id);

const profileBtn = document.getElementById('profileBtn');
const profileDropdown = document.getElementById('profileDropdown');

profileBtn.onclick = function(e) {
  profileDropdown.classList.toggle('show');
  e.stopPropagation();
};
document.addEventListener('click', function(e) {
  if (!profileDropdown.contains(e.target) && !profileBtn.contains(e.target)) {
    profileDropdown.classList.remove('show');
  }
});


function renderMessages() {
  const area = $('chatArea');
  area.innerHTML = '';
  state.messages.forEach(msg => {
    const row = document.createElement('div');
    row.className = 'message-row ' + (msg.sender === 'ai' ? 'ai' : 'user');
    row.innerHTML = `
      <div class="message-avatar">${msg.sender==='ai'?'AI':'U'}</div>
      <div class="message-content">
        ${msg.attachments ? renderAttachList(msg.attachments) : ''}
        ${msg.text ? '<div>'+escapeHTML(msg.text).replace(/\n/g,'<br>')+'</div>':''}
      </div>
    `;
    area.appendChild(row);
  });
  area.scrollTop = area.scrollHeight;
}

function renderAttachList(list) {
  if (!list || !list.length) return '';
  return `<div class="attachments">${list.map(att =>
    att.type==='image'
      ? `<img src="${att.url}" alt="${att.name}">`
      : `<span><i class="${getIcon(att)}"></i> ${att.name}</span>`
    ).join('')}</div>`;
}

function renderAttachmentPreview() {
  if (!state.attachments.length) {
    $('attachmentPreview').style.display = 'none';
    $('previewList').innerHTML = '';
    return;
  }
  $('attachmentPreview').style.display = '';
  $('previewList').innerHTML = state.attachments.map(att => `
    <div class="preview-item">
      ${att.type==='image'?`<img src="${att.url}" alt="${att.name}">`:`<i class="${getIcon(att)}"></i>`}
      <span>${escapeHTML(att.name)}</span>
      <button class="remove" onclick="removeAttachment('${att.id}')"><i class="fas fa-times"></i></button>
    </div>
  `).join('');
}

window.removeAttachment = function(id) {
  state.attachments = state.attachments.filter(a => a.id !== id);
  renderAttachmentPreview();
};

$('clearAttachments').onclick = function() {
  state.attachments.forEach(att => att.url && URL.revokeObjectURL(att.url));
  state.attachments = [];
  renderAttachmentPreview();
};

// Multimodal Upload handlers
$('imageBtn').onclick = () => $('imageInput').click();
$('fileBtn').onclick = () => $('fileInput').click();

$('imageInput').onchange = e => handleAttachments(e.target.files, 'image');
$('fileInput').onchange = e => handleAttachments(e.target.files, 'file');

function handleAttachments(files, type) {
  [...files].forEach(file => {
    state.attachments.push({
      id: Date.now()+Math.random(),
      name: file.name,
      type,
      url: URL.createObjectURL(file),
      size: file.size,
      file,
    });
  });
  renderAttachmentPreview();
}

// Voice Recording
$('micBtn').onclick = async function() {
  if (!state.isRecording) await startVoice();
  else stopVoice();
};

async function startVoice() {
  try {
    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
    state.mediaRecorder = new MediaRecorder(stream);
    const audioChunks = [];
    state.mediaRecorder.ondataavailable = e => audioChunks.push(e.data);
    state.mediaRecorder.onstop = () => {
      const blob = new Blob(audioChunks, {type:'audio/wav'});
      const audioFile = new File([blob], `voice_${Date.now()}.wav`, {type:'audio/wav'});
      state.attachments.push({
        id: Date.now()+Math.random(),
        name: audioFile.name,
        type: 'audio',
        url: URL.createObjectURL(blob),
        size: audioFile.size,
        file: audioFile,
      });
      renderAttachmentPreview();
      stream.getTracks().forEach(track => track.stop());
    };
    state.mediaRecorder.start();
    state.isRecording = true;
    $('micBtn').classList.add('active');
    $('micBtn').innerHTML = '<i class="fas fa-stop"></i>';
  } catch(e) { alert('Mic error');}
}
function stopVoice() {
  if(state.mediaRecorder && state.isRecording){
    state.mediaRecorder.stop();
    state.isRecording = false;
    $('micBtn').classList.remove('active');
    $('micBtn').innerHTML = '<i class="fas fa-microphone"></i>';
  }
}

// Google Drive modal
$('driveBtn').onclick = () => $('driveModal').classList.add('show');
$('closeDrive').onclick = () => $('driveModal').classList.remove('show');
$('driveSignIn').onclick = () => {
  state.driveAuthenticated = true;
  $('driveAuth').style.display = 'none';
  $('driveContent').style.display = '';
  renderDriveFiles([{id:'id1',name:'Report.pdf',mimeType:'application/pdf'},{id:'id2',name:'Pic.jpg',mimeType:'image/jpeg'}]);
}; // Demo only for UI

function renderDriveFiles(files){
  $('driveFiles').innerHTML = files.map(f=>`
    <div class="drive-file" data-id="${f.id}">
      <i class="${getIcon({name:f.name,mimeType:f.mimeType})}"></i>
      <span>${escapeHTML(f.name)}</span>
    </div>
  `).join('');
  Array.from(document.getElementsByClassName('drive-file')).forEach(elem=>{
    elem.onclick = ()=> {
      elem.classList.toggle('selected');
      if(elem.classList.contains('selected')){
        state.attachments.push({
          id: elem.dataset.id,
          name: elem.innerText,
          type: 'drive',
          mimeType: files.find(f=>f.id===elem.dataset.id).mimeType,
        });
      }else{
        state.attachments = state.attachments.filter(a=>a.id!==elem.dataset.id);
      }
      renderAttachmentPreview();
    }
  });
}
$('driveSearch').oninput = function(e){ /* implement search on files if api available */ }

$('sendBtn').onclick = sendMessage;
$('messageInput').oninput = function(){
  $('charCount').innerText = this.value.length;
  $('sendBtn').disabled = !this.value.trim() && !state.attachments.length;
};
$('messageInput').onkeydown = function(e){
  if (e.key==='Enter' && !e.shiftKey){
    e.preventDefault();
    if (!$('sendBtn').disabled) sendMessage();
  }
};
function sendMessage(){
  if (state.isTyping) return;
  // User message
  state.messages.push({
    sender:'user',
    text:$('messageInput').value.trim(),
    attachments: [...state.attachments],
  });
  $('messageInput').value = '';
  $('charCount').innerText = '0';
  $('sendBtn').disabled = true;
  $('attachmentPreview').style.display='none';
  state.attachments=[]; renderAttachmentPreview();
  renderMessages();
  showTyping();
  setTimeout(() => {
    hideTyping();
    state.messages.push({
      sender:'ai',
      text:generateAIResponse(),
      attachments:[], // simulate response, can add logic for multimodal output
    });
    renderMessages();
  }, 1400);
}

function showTyping(){
  state.isTyping = true;
  const area=$('chatArea');
  const row=document.createElement('div');
  row.className='message-row ai';
  row.id='typingRow';
  row.innerHTML=`<div class="message-avatar">AI</div>
    <div class="message-content"><span style="color:var(--accent)">...</span></div>`;
  area.appendChild(row);
  area.scrollTop=area.scrollHeight;
}
function hideTyping(){
  state.isTyping=false;
  const typing=$('typingRow'); if(typing) typing.remove();
}

function generateAIResponse(){ // Simulated for demo
  const last=state.messages[state.messages.length-1];
  let text='Processing your input.';
  if(last.attachments?.length){
    const types=[...new Set(last.attachments.map(a=>a.type))];
    text = "Received: "+types.map(t=>
      t==='image'?'image(s)':t==='file'?'document(s)':t==='audio'?'audio':t==='drive'?'cloud file(s)':''
    ).filter(Boolean).join(', ')+
    ". Please specify what you want me to do with them.";
  }else if(last.text){
    text = "You said: "+last.text;
  }
  return text;
}

// Utility
function escapeHTML(s) {
  return String(s).replace(/[&<>"']/g, m=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"}[m]));
}
function getIcon(obj){
  const name=(obj.name||'').toLowerCase(),
        mime=obj.mimeType||'',
        ext = name.split('.').pop();
  if(mime.startsWith('image/')||['png','jpg','jpeg','gif','bmp'].includes(ext)) return 'fas fa-image';
  if(['mp3','wav','ogg'].includes(ext)||mime.startsWith('audio/')) return 'fas fa-volume-up';
  if(['pdf'].includes(ext)||mime==='application/pdf') return 'fas fa-file-pdf';
  if(['doc','docx'].includes(ext)||mime.includes('word')) return 'fas fa-file-word';
  if(['xls','xlsx','csv'].includes(ext)||mime.includes('excel')) return 'fas fa-file-excel';
  if(mime==='application/vnd.google-apps.document'||mime==='application/vnd.google-apps.spreadsheet') return 'fab fa-google-drive';
  return 'fas fa-file';
}
</script>
</body>
</html>

